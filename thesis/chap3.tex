\chapter{Morse homology}
\label{chap:morse-homology}

\section{Morse complex}
In order to define the Morse complex, we need a sequence of modules over a certain ring and maps between these modules.
Most of the time, we will be working over $\Z/2\Z$, which we will denote by $\Z_2$, but sometimes the ring $\Z$ will be used instead. As will turn out, working over $\Z_2$ will allow us not to worry about orientation and it being a field also has some advantages.

The modules we will considering depend on a Morse function $f$ and consist of formal sums of critical points of a certain index:
\[
    C_k(f) = \Big\{ \sum_{p \in \Crit_k f} n_p p  \mid n_p \in \Z_2\Big\}  = \bigoplus_{p \in \Crit_k f} \Z_2 p
.\] 
Note that this implies that $C_{-1} = C_{-2} = \cdots = 0$ and $C_{n+1} = C_{n+2} = \cdots = 0$, where $n$ is the dimension of the manifold.


\begin{marginfigure}
    \centering
    \incfig{other-sphere-morse-complex-modules}
    \caption{The critical points of the height function can be split up depending on their index and form the generators of the modules in the Morse complex.}
    \label{fig:other-sphere-morse-complex-modules}
\end{marginfigure}

\begin{eg}
    Consider the other sphere in Figure~\ref{fig:other-sphere-morse-complex-modules}. We have
    \[
    C_0 = \{0, a\}  \qquad C_1 = \{0, b\}  \qquad C_2 = \{0, c, d, c+d\} 
    .\] 
\end{eg}

The definition of the differential is based on a pseudo-gradient $X$: it counts trajectories connecting critical points of lower index.
Because critical points of index $k$ generate $C_k$, it suffices to define $\partial_{X,k}$ on these critical points and extend linearly:
\begin{align*}
    \partial_{X, k}: C_k &\longrightarrow C_{k-1} \\
    p &\longmapsto \sum_{q \in \Crit_{k-1} f} \nX Xpq q
,\end{align*}
where $\nX Xpq$ is the number of trajectories of $X$ connecting $p$ and $q$, modulo $2$.
If we require that $X$ satisfies the Smale condition, we will later show that this is well defined, by which we mean that $n_X(p,q)$ is an integer (see also Remark~\ref{remark:trajectories-finite}).
If it is clear from the context, we will often drop $X$, $k$ or both from the notation.
\begin{eg}
    Consider again the other sphere with its height function.
    Let $X$ be the gradient induced from the standard gradient in $\R^3$.
    Then $\partial_X$ is defined as follows, keeping in mind that we are working over $\Z_2$ and that $C_{-1} = 0$:
\begin{figure}[H]
    \centering
    \incfig{morse-homology-other-sphere-differential}
    \caption{Definition of the differential $\partial_X$}
    \label{fig:morse-homology-other-sphere-differential}
\end{figure}
\end{eg}

With this information, we are ready to define the Morse complex and Morse homology.
\begin{definition}[Morse complex]
    Let $f:M \to \R$ be a Morse function and $X$ a pseudo-gradient with the Smale property.
    Then the Morse complex is 
    \[
        \cdots \xrightarrow{\partial} C_2(f) \xrightarrow{\partial}  C_1(f) \xrightarrow{\partial} C_0(f) \textcolor{gray}{{} \xrightarrow{\partial}  0 \xrightarrow{\partial }0 \xrightarrow{\partial}  \cdots}
    \] 
    The Morse Homology $\HM{f}{X}$ is the homology of this chain complex.
\end{definition}
The attentive reader will have noticed that for this to be a chain complex, we need $\partial^2 = 0$, which is not obvious at all.
Apart from this, we also would to like to prove that  this homology does not depend on the choice of the Morse function $f$ and the pseudo-gradient field $X$.
We will address these topics in the two following sections, but let us first compute the Morse homology of some examples.


\begin{marginfigure}
    \centering
    \incfig{other-sphere-and-normal-sphere-morse-complex}
    \caption{TODO other sphere and normal sphere morse complex}
    \label{fig:other-sphere-and-normal-sphere-morse-complex}
\end{marginfigure}

\begin{eg}[Homology of the (other) sphere]
    We have already computed the differential in the previous example,
    so computing the homology is just a matter of applying the definition.
    \begin{itemize}
        \item $\HM[0]{f}{X} = \dfrac{\Ker \partial: C_0 \to  C_{-1}}{\Im \partial: C_1 \to  C_0} = \dfrac{\{0, a\} }{\{0\} } \cong \Z_2$
        \item $\HM[1]{f}{X} = \dfrac{\Ker \partial: C_1 \to  C_{0}}{\Im \partial: C_2 \to  C_1} = \dfrac{\{0, b\} }{\{0, b\} } \cong 0$
        \item $\HM[2]{f}{X} = \dfrac{\Ker \partial: C_2 \to  C_{1}}{\Im \partial: C_3 \to  C_2} = \dfrac{\{0, c+d\}}{\{ 0\}} \cong \Z_2$
    \end{itemize}
    In summary, we have
    \[
        H_0 = \Z_2 \qquad H_1 = 0 \qquad H_2 = \Z_2
    .\] 

    Instead of embedding $S^2$ in this strange way, we can also repeat the same calculation with its standard embedding, illustrated in Figure~\ref{fig:other-sphere-and-normal-sphere-morse-complex}.
    We have $ C_2 = \{0, b\} $, $ C_1 = \{0\} $  and $C_0 = \{0, a\}$, and $\partial(b) = 0$,  $\partial(a) = 0$.
    This way, we obtain
    \begin{itemize}
        \item $\HM[0]{g}{Y} = \dfrac{\Ker \partial: C_0 \to  C_{-1}}{\Im \partial: C_1 \to  C_0} = \dfrac{\{0, a\} }{\{0\} } \cong \Z_0$  
        \item $\HM[1]{g}{Y} = \dfrac{\Ker \partial: C_1 \to  C_{0}}{\Im \partial: C_2 \to  C_1} = \dfrac{\{0\} }{\{0\} } \cong 0$
        \item $\HM[2]{g}{Y} = \dfrac{\Ker \partial: C_2 \to  C_{1}}{\Im \partial: C_3 \to  C_2} = \dfrac{\{0, b\} }{\{0\} } \cong \Z_2$
    \end{itemize}
    In summary, we have 
    \[
    H_0 = \Z_2 \qquad H_1 = 0 \qquad H_2 = \Z_2
    ,\] 
    exactly the same homology as with the other Morse function and other gradient.
    As mentioned earlier, we will prove that this is in general the case.
\end{eg}
\begin{eg}[Homology of the three-torus]
    \label{eg:homology-of-the-three-torus}
    Let us recall Example~\ref{eg:handle-decomposition-three-torus}, which discusses the three-torus $T^{3} = S^{1} \times S^{1} \times S^{1} = \R^3 / \Z^3$ and the following Morse function
    \begin{marginfigure}
        \centering
        \incfig{morse-homology-three-torus-trajectories}
        \caption{
        Trajectories connecting critical points whose index differ by exactly $1$.
        Here $T^{3} = \R^{3} / \Z^{3}$ and we have drawn $\big(-\frac{1}{2}, \frac{1}{2}\big]^3$ as representative cube.  }
        \label{fig:morse-homology-three-torus-trajectories}
    \end{marginfigure}
    \begin{marginfigure}
        \centering
        \incfig{mores-homology-three-torus-critical-points-graph}
        \caption{Graph of the critical points of $f$ on $T^{3}$.
            Each edge represents a flow line between points whose indices differ by one.
        }
        \label{fig:mores-homology-three-torus-critical-points-graph}
    \end{marginfigure}
    \begin{align*}
        f: T^3 &\longrightarrow \R \\
        (x,y,z) &\longmapsto 2 \cos(2 \pi x)+ 3 \cos(2 \pi y) + 4 \cos (2 \pi z),
    \end{align*}
    with critical values repeated here for convenience:
    \[\begin{array}{cccccc}
  & x & y  & z & f(x, y, z) & \text{Index}\\ \hline
  & 0 & 0 & 0 & 9 & 3 \\
& \frac{1}{2} & 0 & 0 & 5 & 2 \\
& 0 & \frac{1}{2} & 0 & 3 & 2 \\
& 0 & 0 & \frac{1}{2} & 1 & 2 \\
& \frac{1}{2} & \frac{1}{2} & 0 & -1 & 1 \\
& \frac{1}{2} & 0 & \frac{1}{2} & -3 & 1 \\
& 0 & \frac{1}{2} & \frac{1}{2} & -5 & 1 \\
& \frac{1}{2} & \frac{1}{2} & \frac{1}{2} & -9 & 0 \\
    \end{array}\]
    The differential equation for trajectories along $\grad f$ is 
    \begin{align*}
        \dot x &= -4 \pi \sin(2 \pi x)\\
        \dot y &= -6 \pi \sin(2 \pi y)\\
        \dot z &= -8 \pi \sin(2 \pi z)
    .\end{align*} 


    Note that $\dot x$ only depends on  $x$,  $\dot y$ on  $y$ and  $\dot z$ on $z$, so this is a decoupled system that is easy to solve.
    Requiring that for $t \to  \pm\infty$ we end up in critical points, we find the trajectories in Figure~\ref{fig:morse-homology-three-torus-trajectories}.
    To have a better overview, we can also make a graph of critical points and trajectories between them, as is done in Figure~\ref{fig:mores-homology-three-torus-critical-points-graph}.
    This graph provides all the information we need to compute the Morse homology of $T^{3}$.
    Note that all critical points are connected with two gradient lines, which means that each differential $\partial_3, \partial_{2}, \partial_1, \partial_0$ is the zero map, making it very easy to compute the homology. In the end, we get
    \[
    H_0 = \Z_2 \qquad 
    H_1 = \Z_2^3 \qquad 
    H_2 = \Z_2^3 \qquad 
    H_3 = \Z_2
    ,\] 
    which corresponds to the usual homology.
\end{eg}

\section{The Morse complex is a complex: $\partial^2 = 0$}
In this section, we will prove that the Morse complex is actually a complex, by which we mean that $\partial^2 = 0$.
The core idea of the proof is very geometrical and depends on the fact that compact manifolds with boundary have an even number of boundary points.\sidenote{TODO: reference or prove!}
We will first make this core idea clear, and then make this argument exact.

Let us first restate what we have to prove. Let $a \in \Crit_k f$ be a critical point of a Morse function $f: M \to  \R$.
We need to prove that $\partial^2(a) = 0$, so\sidenote{
    TODO will denote top middle and bottom point with $a, c, b$.
    Strange maybe but useful later on.
}
\begin{align*}
    \partial^2(a) &= \partial \Big(\sum_{c \in \Crit_{k-1} f} n_X(a, c) c\Big)\\
                  &= \sum_{b \in \Crit_{k-1} f} \sum_{c \in \Crit_k f} n_X(a, c) n_X(c, b) b
.\end{align*} 
We see that $\partial^2(a)$ counts trajectories from $a$ to points of index $k-2$ that are once broken in a critical point of index $k-1$.
Remember that we are working over $\Z_2$, so if we can prove that these once broken trajectories always occur in pairs, we are done.
The core idea of the proof is to notice that these once broken trajectories together with the space of unbroken trajectories $\L ab$ form a compact 1-dimensional manifold with boundary exactly the broken trajectories. We have illustrated this in Figure~\ref{fig:morse-complex-is-a-complex-idea-of-proof}.
In other words, we can compactify $\L ab$ by adding the once broken trajectories between $a$ and $c$, resulting in a space we will denote by $\Lb ab$.
As previously remarked, this is sufficient to prove that $\partial^2(a) = 0$, because compact 1-dimensional manifolds always have an even number of boundary points.\sidenote{
    TODO In the oriented context, the signed number of boundary points is zero.
}

\begin{marginfigure}
    \centering
    \incfig{morse-complex-is-a-complex-idea-of-proof}
    \caption{
        Core idea of the proof stating $\partial^2 = 0$.
        There are two unbroken trajectories from $a$ to $b$, one passing through $c_1$ and one through $c_2$.
        There is a one parameter family of unbroken trajectories interpolating between the two broken ones.
        Together, they form a compact 1-dimensional manifold with boundary, which has an even number of boundary points.
    }
    \label{fig:morse-complex-is-a-complex-idea-of-proof}
\end{marginfigure}

Before we proceed with this idea, let us give an overview of the works that needs to be done.

\begin{enumerate}
    \item Define $\Lb ab$, the space of all (broken and unbroken) trajectories.
    \item Define a topology on $\Lb ab$ so that we are able to talk about compactness
    \item Prove that  $\Lb ab$ is the compactification of $\Lb ab$
    \item Prove that if $\Ind a - \Ind b = 2$, then $\Lb ab$ is a 1-dimensional manifold with as boundary the once broken trajectories between $a$ and  $b$
\end{enumerate}

\subsection{The space of broken trajectories}
\begin{definition}
    The space of broken trajectories between $a$ and  $b$ is
     \[
         \Lb ab = \bigcup_{c_i \in \Crit f} \L a{c_1} \times \L {c_1}{c_2} \times  \cdots \times \L {c_\ell}b
    .\] 
\end{definition}

    Note that the number $\ell$ describes how many times the trajectory is broken.
    In other words, each broken trajectory in $\L a{c_1} \times \L {c_1}{c_2} \times  \cdots \times \L {c_\ell}b$ has $ \ell+1$ segments,  and we will denote such a trajectory by $(\lambda_1, \lambda_2, \cdots, \lambda_{\ell+1})$.
    In the case where $(\Ind a, \Ind c, \Ind b) = (k, k-1, k-2)$, this definition results in
    \[
        \Lb ab = \L ab \cup  \bigcup_{c \in \Crit_{k-1} f}  \L a{c} \times \L {c} b
    ,\] 
    which makes it clear it is the union of unbroken and once broken trajectories.
    


\subsection{Topology of $\Lb ab$}
% Also remember that $\L ab$ is homeomorphic to $\traj ab \cap f^{-1}(\alpha)$ for some regular value $\alpha$ between $f(a)$ and $f(b)$,

To define the topology on $\Lb ab$,
we will describe a basis around a (possibly broken) trajectory.
Let $(\lambda_1, \lambda_2, \ldots, \lambda_q)$ be a trajectory in $\Lb ab$.
Consider Morse charts around each critical point  $a, c_1, c_2, \ldots, c_{q-1}, b$.
Consider opens around entry and exit points of the trajectories, lying in level sets of $f$, indicated in the figure with thick black lines.
We declare all trajectories passing through these opens to be in a open neighborhood of $(\lambda_1, \lambda_2, \ldots, \lambda_q)$.
Doing this for all possible `entrance and exit opens' defines a basis of the topology.

Remember that the topology of  $\L ab$ came from the one on $\traj ab \subset M$ using the projection map $\pi: \traj ab \to \L ab $.
We also mentioned that $\L ab$ is homeomorphic to $\traj ab \cap  f^{-1}(\alpha)$ for some regular value $\alpha$, making it clear that the topology on $\Lb ab$ corresponds to the one  $\L ab$ for unbroken trajectories.

So the essence of the topology on $\Lb ab$ is: `trajectories are nearby if entrance and exit points in Morse charts are nearby'.
\begin{marginfigure}
    \centering
    \incfig{morse-homology-definition-of-topology}
    \caption{TODO morse homology definition of topology}
    \label{fig:morse-homology-definition-of-topology}
\end{marginfigure}

\subsection{$\Lb ab$ is the compactification of $\L ab$}
Now we are ready to prove that $\Lb ab$ is compact, and in fact a compactification of  $\L ab$.\sidenote{By this, we mean that there are points in $\L ab$ arbitrary close to ones in  $\Lb ab$.}
\begin{theorem}
    $\Lb ab$ is compact
\end{theorem}

We will actually prove that $\Lb ab$ is sequentially compact, which will turn out to be enough for our needs, and is in this context actually equivalent with being compact.

\begin{figure}[H]
    \centering
    \incfig{partial-squared-zero-space-compact}
    \caption{TODO partial squared zero space compact.
        Note that the figure is somewhat misleading because of lack of dimensions.
        Doesn't seem lik $b_n^{+}$ can move, but they in fact can.
        We have drawn $a$ as a $2$-handle in order to make this freedom more clear.
    }
    \label{fig:partial-squared-zero-space-compact}
\end{figure}
\begin{proof}
    Let $ \ell_n$ be a sequence of trajectories in $\L ab$.\sidenote{Note that we first consider a sequence of \emph{unbroken} trajectories.}
    Let $\Omega(a)$ be a Morse chart around $a$.
    Consider the points where $\ell_n$ exits the Morse chart $a$, call them $a_n^{-}$.
    Extract a subsequence of $\ell_n$ such that $a_{n}^{-}$ converges\sidenote{\todo{This uses compactness of sphere.}} and call the point of convergence $a^{-}$.
    We will denote the extracted subsequence again by $\ell_n$ and will do so continuously in the proof.
    Similarly, extract a subsequence such that $b_n^{+}$, defined as the entry point in the Morse chart of $b$ converges to a point $b^{+}$.
    In conclusion, we have a subsequence whose exit point in $\Omega(a)$  converges to $a^{-}$ and whose entrance in $\Omega(b)$ converges to  $b^{+}$.

    Let us now try to construct a trajectory that is the `accumulation trajectory'\sidenote{By this, we simply mean an accumulation point of the sequence $\ell_n$, but this terminology can be confusing because it is not a point in the geometrical sense of the word.} of $\ell_n$.
    An obvious starting point would be to consider the unique trajectory $\gamma_1$ passing through $a^{-}$ going from $a$ to another critical point.
    Suppose for a moment that this other critical points is in fact $b$, so $\gamma_1$ connects  $a$ and  $b$, as in case 1 in Figure~\ref{fig:partial-squared-zero-space-compact}.
    Lemma~\ref{lemma:level-sets}, which we will prove later on\sidenote{
        \textbf{Lemma~\ref{lemma:level-sets}.}
        Let $x$ be a regular point of $f$ and $x_n \to x$.
        Let $y_n$ and  $y$ be points lying on the same trajectory of $X$ as  $x_n$ and  $x$.
        Suppose all $y_n$ lie on the same level as  $y$, i.e.  $f(y_n) = f(y)$.
        Then  $y_n \to  y$.
        }, implies that the entry points of $\ell_n$ in $\Omega(b)$ converge to the entry point of $\gamma_1$. This then proves that $\ell_n \to  \gamma_1$\sidenote{
        By definition of our topology, a sequence of unbroken trajectories connecting $a$ to  $b$ ($\ell_n$) converges to an unbroken trajectory ($\gamma_1$) if entry and exit points converge.
    }.

    Now, what about the other case, when $\gamma_1$ connects $a$ and another critical point $c \neq b$?
    We claim that the accumulation trajectory of $\ell_n$ will be a trajectory that is at least broken in $c$.
We have again that the entry points of $\ell_n$ in $\Omega(c)$ (call them $c_n^{+}$) converge to the entry point of $\gamma_1$, so the first segment of the accumulation trajectory will be $\gamma_1$.
To find the second segment of the accumulation trajectory, we would again want a starting point (like we had $a^{-}$ before) in the unstable manifold of $c$ to flow from in order to find $\gamma_{2}$.
For this, extract a subsequence of $\ell_n$ such that their exit points $c^{-}_n$ in $\Omega(c)$ converge to a point $c^{-}$.
We claim that $c^{-}$ lies in the unstable manifold of $c$.\sidenote{
    Suppose that it does not.
    Then we could flow back $c^{-}$ to a point $c^{\star}$ with $f(c^{\star}) = f(c^{+})$.
    Note that $c^{\star}$ is not in the stable manifold of $c$. (Otherwise, flowing forward again we would end up in  $c$)
    Applying the lemma again, $c_n^{+} \to  c^{\star}$ meaning that $c^{\star} = c^{+}$. This cannot be possibly right since $c^{\star}$ is not in the stable manifold of $c$, but $c^{+}$ is, by definition.
}
This means that when we flow back, we indeed get to $c$ like we wanted, and when we flow forward, we get to another critical point, which may be $b$, or $d$, yet another critical point. This way we go on and find a subsequence of $\ell_n$ that converges to $(\gamma_1, \gamma_2, \ldots, \gamma_k)$.

In order to complete the proof for a sequence $\ell_n$ in $ \Lb ab$ (instead of $\L ab$), note that for sufficiently large $n$ and after extracting a subsequence, the critical points where $ \ell_n$ is broken do not change. Then apply the proof above to the first segment, then to the second, \ldots
\end{proof}

% \todo{Introduce $\Omega(p)$ as notation for Morse chart around  $p$}


The lemma used in the above proof says that points $y_n$ on trajectories that pass through a convergent sequence of points $x_n \to x$ also converge, at least if $y_n$ all lie on the same level.
\begin{marginfigure}
    \centering
    \incfig{lemma-partial-squared-zero-proof}
    \caption{TODO lemma partial squared zero proof}
    \label{fig:lemma-partial-squared-zero-proof}
\end{marginfigure}
\begin{lemma}
    Let $x$ be a regular point of $f$ and $x_n \to x$.
    Let $y_n$ and  $y$ be points lying on the same trajectory of $X$ as  $x_n$ and  $x$.
    Suppose all $y_n$ lie on the same level as  $y$, i.e.  $f(y_n) = f(y)$.
    Then  $y_n \to  y$.
    \label{lemma:level-sets}
\end{lemma}
\begin{proof}
    The idea of the proof is to flow $y_n$ to  $x_n$ and $y$ to $x$ so that convergence of $x_n$ implies convergence of $y_n$.
    Let  $\psi_t$ be the flow of  $-\frac{1}{df (X)} X$ on a subset of $M$ that contains $x_n, y_n, x, y$ for large enough  $n$ and does not contain critical points.
    Then $f(\psi_t(z)) = f(z) - t$, so
     \[
         y_n = \psi_{-f(y_n) + f(x_n)}(x_n) = \psi_{-f(y) + f(x_n)}(x_n) \xrightarrow{n \to \infty}   \psi_{-f(y) + f(x)}(x) = y
    .\] 
\end{proof}

Note that the proof of the previous theorem also shows that $\Lb ab $ is actually the compactification of  $\Lb ab$, in the sense that there are elements of  $\L ab$ that are arbitrarily close to a fixed element of $\Lb ab$.

\subsection{$\Lb ab$ is a 1-dimensional manifold with boundary}
With the preceding technical lemmas,
we are ready to complete the proof stating that the Morse complex is actually a complex, i.e.\ $\partial^2 = 0$, with yet another technical lemma.


\begin{theorem}
    Let $a, b$ be critical points of  $M$ such that  $\Ind a - \Ind b = 2$. Then  $\Lb ab$ is a compact  $1$-dimensional manifold with boundary.
\end{theorem}

We already know that $\L ab$ is a 1-manifold, so the following proposition immediately implies the theorem.

\begin{prop}
    Let $M$ be a compact manifold and $f: M \to  \R$ a Morse function with adapted pseudo-gradient $X$ satisfying the Smale property. Let  $a,c,b$ be three critical points of indices  $k+1, k$ and $k-1$. Let $\lambda_1 \in \L ac$ and $\lambda_2 \in \L cb$.
    There exists a continuous embedding $\psi$ from $[0, \delta)$ to a neighborhood of $(\lambda_1, \lambda_2)$ in $\Lb ab$ such that
    \[
    \begin{cases}
        \psi(0) = (\lambda_1, \lambda_2) \in \Lb ab\\
        \psi(s) \in \L ab \quad \text{ for } s \neq 0.
    \end{cases}
    \] 
    Moreover if $(\ell_n)$ is a sequence in $\L ab$ that tends to $(\lambda_1, \lambda_2)$, then $ \ell_n$ is eventually contained in the image of $\psi$.
\end{prop}

The last part is important in order to show that broken trajectories actually form the boundary, as illustrated in Figure~\ref{fig:l-bar-last-condition-of-manifold-with-boundary}.
\begin{marginfigure}
    \centering
    \incfig{l-bar-last-condition-of-manifold-with-boundary}
    \caption{We can embed a half open interval $[a, b)$ in $\R$, but that does not mean that $a$ is a boundary point of $\R$. Clearly, there exists $x_n \to a$ that is not eventually contained in $[a,b)$.
        Requiring that this last condition always holds ensures that $a$ is actually a boundary point.
    }
    \label{fig:l-bar-last-condition-of-manifold-with-boundary}
\end{marginfigure}

\begin{proof}
    Let us first consider a $2$-dimensional manifold, where the only interesting case is $(\Ind a, \Ind c, \Ind b) = (2,1,0)$.

    \begin{marginfigure}
        \centering
        \incfig{l-bar-manifold-2-dimensional-case}
        \caption{TODO l bar manifold 2 dimensional case}
        \label{fig:l-bar-manifold-2-dimensional-case}
    \end{marginfigure}
    Choose a Morse chart around $c$ that lies between level sets $\alpha \pm \epsilon$ where  $\alpha = f(c)$.
    The trajectories starting in $a$ meet $f^{-1}(\alpha + \epsilon)$ transversely.
    Let $P$ be their intersection, i.e. $\unstable{a} \cap  f^{-1}( \alpha + \epsilon)$.
    Let $c^{+}$ be the entry point of $\lambda_1$ in  the Morse chart of $c$, which is contained in the $1$-manifold $P$.

    The idea is that we will embed an interval $[0, \delta)$ as on the figure in the level set $\alpha + \epsilon$. Call this embedding $\chi$.
    The problem is however, we have to find a way to determine in what direction the second part of the broken trajectory ($\lambda_2$) exits $c$ so that we embed this interval on the `correct side' in order for the trajectories passing through these points to lie in a neighbourhood of $(\lambda_1, \lambda_2)$.
    In the figure, we need to embed it `on the right', because $\lambda_2$ exits on the right.

    The map $\psi:(0, \delta) \to  \L ab$ will then map $t$ to the trajectory passing through the point $\chi(t)$.
    Note that once again we have to be careful at the endpoint, but if we have found the `correct side', this will be no problem, and we will be able to extend $\psi$ to $[0, \delta)$ by mapping  $0 \mapsto (\lambda_1, \lambda_2)$.

    In order to solve the problem, we first consider `all directions', by embedding an open interval $D^{1}$ that is small enough \emph{centred} around $c^{+}$, i.e. a map $\Psi: (D^{1}, 0) \to  (P, c^{+})$.
    Now, flow $\psi(D^{1} \setminus \{0\} )$ along $X$ until it reaches the level set $\alpha - \epsilon$, as in Figure~\ref{fig:l-bar-manifold-2-dimensional-case-part-flow}.
    \begin{marginfigure}
        \centering
        \incfig{l-bar-manifold-2-dimensional-case-part-flow}
        \caption{TODO l bar manifold 2 dimensional case part flow}
        \label{fig:l-bar-manifold-2-dimensional-case-part-flow}
    \end{marginfigure}
    This defines an embedding $\Psi: D^{1} \setminus \{0\} \to  f^{-1}(\alpha-\epsilon)$, which splits up $D^{1}$ into two parts.
    If we add in $S^{-} := f^{-1}(\alpha-\epsilon) \cap \unstable{c}$, which in this case consists of two points, the result forms a one-dimensional manifold $Q$ (with boundary $S^{-}$).\sidenote{
        This is intuitively clear and can be verified by doing this in local coordinates, computing the flow explicitly.
        This also works in higher dimensions.
    }

    With this done, we are ready to determine the `correct direction'.
    Because of the Smale condition $\stable b \tcap \Im \Phi$ and  $\stable b \tcap S^{-}$.
    This means $\stable b \cap Q$ is a submanifold of dimension $1$ with boundary isomorphic to $\L cb$.
    In the figure, this submanifold is the right part of $Q$, with boundary the right point of $S^{-}$, a single point representing the only trajectory from $c$ to $b$, i.e. representative for $\L c b$.
    Now our problem is solved and we know the `right direction'.
    Let $c^{-}$ be the exit point of $\lambda_2$ (intersection of $\lambda_2$ and $S^{-}$). 
    Define a map $\chi:[0, \delta) \to  \stable b \cap  Q$ mapping $0$ to  $c^{-}$.\sidenote{TODO: this $\chi$ parametrizes a different manifold than before \ldots Fix this}
    Similarly as before by applying the previous lemma, this defines a map $\psi: [0, \delta) \to  \Lb ab$ with $\psi(0) = (\lambda_1, \lambda_2)$.

    For the last statement in the theorem, let $\ell_n \to  (\lambda_1, \lambda_2)$ be a sequence in $\L ab$. Let $ \ell^{\pm}_n$ denote entry and exit points. 
    Eventually, $\ell_n^{+} \in \psi(D \setminus \{0\})$, hence $ \ell_n^{-} \in Q$. This implies that $ \ell_n^{-} \in Q \cap \stable b = \Im \chi$.
    This proves that $ \ell_n \in \Im \psi$.

    In higher dimensions, the proof is actually almost exactly the same.
    While there are many more directions from which to enter or leave the Morse chart of $c$, the procedure outlined above works, with a few adjustments to be made.
    The dimension of $P$ is $k$, which we parametrize around $c^{+}$ by $D^{k}$ instead of $D^{1}$. Flowing this along $X$ and adding $S^{+}$ we get a $k$-dimensional manifold with boundary.\sidenote{This time, the manifold does not split into two parts, but becomes an annulus} Taking the intersection with  $\stable b$, we get a one-dimensional manifold (by counting dimensions and using that codimensions add when intersection is transverse), and the proof finishes in the same way.
    In Figure~\ref{fig:lbar-manifold-three-dimensional-case} we have illustrated the three dimensional case with $\Ind c=2$.

\begin{marginfigure}
    \centering
    \incfig{lbar-manifold-three-dimensional-case}
    \caption{TODO lbar manifold three dimensional case TODO: extremely ugly figure}
    \label{fig:lbar-manifold-three-dimensional-case}
\end{marginfigure}
\end{proof}
\subsection{Conclusion}


\filbreak
\section{Morse homology is independent of the Morse function and gradient}
\begin{theorem}
    Let $M$ be a compact manifold and $ f_0, f_1: M \to  \R$ two Morse functions.
    Let $X_0, X_1$ be pseudo-gradients adapted to $f_0$ and $ f_1$ respectively with the Smale property.
    Then there exists a morphism of complexes
    \[
        \Phi_{\bul}:
        (C_\bul(f_0), \partial_{X_0}) \to  
        (C_\bul(f_1), \partial_{X_1})
    ,\] 
    that induces an isomorphism on the level of homology.
\end{theorem}
    
\begin{proof}
The proof of this theorem is truly something to behold: it features an intricate interplay between homological algebra and differential geometry.
\paragraph{Construction of a morphism of complexes}
In order to find a connection between the two complexes, we geometrically connect $f_0$ and $f_1$ via a stable interpolation by which we mean a smooth map
\[
    F: [0,1] \times M \to \R: (s, m) \mapsto F_s(m)
,\] 
such that $F_s = f_0$ for $s \in \left[0, \frac{1}{3}\right]$ and $F_s = f_1$ for $s \in \left[\frac{2}{3}, 1\right]$.
On of the reasons of looking specifically at stable interpolations is that we can concatenate them and again get a $C^{\infty}$ map that is a stable interpolation.

We can visualize an interpolation between two morse functions by embedding $[0,1] \times M$ in $\R^{n+1}$ in such a way that the height function in each slice corresponds to $F_s$.
For example, doing this for the circle and the other circle, we get Figure~\ref{fig:morse-homology-independence-cilinder}.

\begin{marginfigure}
    \centering
    \incfig{morse-homology-independence-cilinder}
    \caption{TODO morse homology independence cilinder}
    \label{fig:morse-homology-independence-cilinder}
\end{marginfigure}

Seen from a Morse perspective, the result is less than desirable: the function $F$ is not a Morse function: critical points in the stationary parts of $F$ are degenerate as $\frac{\partial F}{\partial s} = 0$.
Furthermore, an interpolation of two Morse functions need not to be Morse at each point in time which gives even more degenerate critical points. We have highlighted an example of this in the figure.

\begin{marginfigure}
    \centering
    \incfig{morse-homology-independence-tube}
    \caption{TODO morse homology independence tube}
    \label{fig:morse-homology-independence-tube}
\end{marginfigure}

\begin{marginfigure}
    \centering
    \incfig{morse-homology-independence-g-function}
    \caption{TODO morse homology independence g function}
    \label{fig:morse-homology-independence-g-function}
\end{marginfigure}

We can fix this problem by replacing the horizontal tube by a `slide', as seen in Figure~\ref{fig:morse-homology-independence-tube}.
We do this by extending $F$ to $[-\frac{1}{3}, \frac{3}{4}]$ and adding a function $g$ (illustrated in Figure~\ref{fig:morse-homology-independence-g-function}) along the $s$-direction, i.e.\ $\tilde{F}_s(p) = F_s(p) + g(s)$.\sidenote{We extend the function such that the critical values of $\tilde{F}$ do not lie on the boundary.}
Whatever kind of tube we start with, if we make the slide steep enough, we will always slide down and never have flat spots, except at the top and bottom of the slide.
This means if we choose $g$ appropriately\sidenote{
    More explicitly, we want $\frac{\partial F}{\partial s} (p, s) + g'(s) <0$ for all $p \in M, s \in (0,1)$.
}, the only critical points lie in the slices $s=0$ and  $s=1$ and correspond to critical points of $f_0$ and $f_1$ respectively.
Because $g$ is Morse, these critical points remain nondegenerate.
We conclude that $\tilde{F}$ is in fact Morse with critical points $\Crit(\tilde{F}) = \{0\} \times \Crit(f_0) \cup \{1\} \times \Crit(f_1)$.

We can also determine the index of these critical points.
Because we have created an extra downward direction at the top of the slide, the indices of these critical points have increased by $1$.
At the bottom, the indices stay the same, giving us
\[
    C_{k+1}(\tilde{F}) = C_k(f_0) \oplus C_{k+1}(f_1)
.\] 

Apart from the critical points, we are also interested in constructing a pseudo-gradient on $[0,1]\times M$, as this will give rise to a differential.
 On $[-\frac{1}{3}, \frac{1}{3}] \times M$, we set $X = X_0 - \grad g$, and on $\left[\frac{2}{3}, \frac{4}{3}\right] \times M$ we set $X = X_1 - \grad g$.\sidenote{Here, $\grad g$ is the Euclidian gradient}
A partition of unity argument then fills in the gaps.
Note that this pseudo-gradient is transversal to the boundary of $\left[-\frac{1}{3}, \frac{4}{3}\right]$.
We can slightly perturb $X$ to make it satisfy the Smale condition and we can furthermore assume that the resulting vector field, $\tilde{X}$ is transversal to $ \{s\} \times M$ for $s \in \left\{-\frac{1}{3}, \frac{1}{3}, \frac{2}{3}, \frac{4}{3}\right\}$.
We can also make this perturbation small enough such that $\partial_{X} = \partial_{\tilde{X}}$, that is to say, the number of $X$-trajectories between critical points is the same as the number of $\tilde{X}$-trajectories.

Having a Morse function $\tilde{F}$ and a pseudo-gadient $\tilde{X}$ that is adapted to $\tilde{F}$, we can consider the associated Morse complex $(C_\bul(\tilde{F}), \partial_{\tilde{X}})$.
There are two types of trajectories connecting critical points of $\tilde{F}$: ones that stay in the same section ($s = 0$ or $s = 1$)  and ones that connect critical points of $f_0$ to critical points of $f_1$, i.e. ones that `slide down the slide'.
This means we can decompose $\partial_{\tilde{X}}$ as follows:
\begin{align*}
    \partial_{\tilde{X}}: C_k(f_0) \oplus C_{k+1}(f_1) &\longrightarrow C_{k-1}(f_0) \oplus C_k(f_1) \\
    (p_0, p_1) &\longmapsto (\partial_{X_0}(p_0), \partial_{X_1}(p_1)+ \Phi^{F}(p_0))
,\end{align*}
where $\Phi^{F}$ counts the trajectories connecting critical points of $f_0$ to ones of $f_1$. We can also write this as a matrix:
\todo{Talk about cone construction in homological algebra!}
\[
\partial_{\tilde{X}} = \begin{pmatrix}
    \partial_{X_0} & 0 \\
     \Phi^{F}& \partial_{X_1}
\end{pmatrix}
.\] 

\begin{marginfigure}
    \centering
    \incfig{morse-homology-independence-partial-squared-zero}
    \caption{TODO morse homology independence partial squared zero}
    \label{fig:morse-homology-independence-partial-squared-zero}
\end{marginfigure}

Let us now look at what the identity $\partial_{\tilde{X}}^2 = 0$ means in this context. Let $p \in C_k(f_0)$.
Then
\begin{align*}
    \partial_{\tilde{X}}^2 (p, 0) &= \partial_{\tilde{X}}(\partial_{0}(p),  \Phi^{F}(p))\\
                                                      &= (\partial_0^2(p), \Phi^{F}\partial_0(p)+ \partial_1 \Phi^{F}(p))\\
                                                    &= (0, \Phi^{F}\partial_0(p)+ \partial_1 \Phi^{F}(p))
.\end{align*} 
Because we are working over $\Z_2$, this means that $\Phi^{F}  \circ  \partial_0 = \partial_1  \circ  \Phi^{F}$, i.e.\ the following diagram commutes for all $k$:
\[
    \begin{tikzcd}
        C_k(f_0) \arrow[d, "\Phi^{F}"]\arrow[r, "\partial_0"] &C_{k-1}(f_0) \arrow[d, "\Phi^{F}"]\\
        C_k(f_1) \arrow[r, "\partial_1"] &C_{k-1}(f_1)\\
    \end{tikzcd}
\]
This proves that $\Phi^{F}$ is a morphism of complexes.

\paragraph{$\Phi^{F}$ induces an isomorphism on the level on homology}

We will now prove that prove that this map induces an isomorphism on the level of homology.
Let $f_0, f_1, f_2$ be Morse functions $M \to  \R$.
Suppose $F$ interpolates between $f_0$ and $f_1$,
$G$ between $f_1$ and $f_2$ and $H$ between $f_0$ and $f_1$, i.e.\ we are in the following situation:
\[
    \begin{tikzcd}
        f_0 \arrow[rr, "H"', bend right] \arrow[r, "F"] &f_1 \arrow[r, "G"] &f_2.
    \end{tikzcd}
\]
We claim that the maps induced by $\Phi^{G} \circ \Phi^{F}$ and $\Phi^{H}$ on the level of homology coincide, or equivalently, they are chain homotopic, meaning that there exists an operator $S$ such that
 \[
\Phi^{G}  \circ  \Phi^{F} - \Phi^{H} = \partial S + S \partial
.\] 
This is sufficient to prove that $\Phi^{F}$ induces an isomorphism.
Indeed, it is easy to check that if $I$ is a constant interpolation between  $(f_0, X_0)$ and itself, 
\[
    I: [0,1] \times M \to  \R: (s, p) \mapsto f_0(m),
\] 
then $\Phi^{I} = \operatorname{Id}$.
So consider $F$ a stationary interpolation between $f_0$ and $f_1$ and $G$, the reverse interpolation from $f_1$ to $f_0$ and $H = I$. Then the induced homological maps $\Phi^{F}$ and $\Phi^{G}$ are inverses of each other.

Let us prove that $\Phi^{G}  \circ  \Phi^{F}$ and $\Phi^{H}$ are chain homotopic.
The idea of this part of the proof is very similar to the first part.
Instead creating one slide from $f_0$ to $f_1$ by adding an extra dimension, we create a two dimensional slide with as sides four slides: $f_0 \xrightarrow{F} f_1$, $ f_1 \xrightarrow{G} f_2$, $f_0 \xrightarrow{H}  f_2$ and $ f_2 \xrightarrow{I} f_2$.

\begin{marginfigure}
    \centering
    \incfig{morse-homology-independence-two-dimensional-slide}
    \caption{TODO morse homology independence two dimensional slide}
    \label{fig:morse-homology-independence-two-dimensional-slide}
\end{marginfigure}

More concretely, we create a map
\[
    K: \left[-\tfrac{1}{3}, \tfrac{4}{3}\right] \times \left[-\tfrac{1}{3}, \tfrac{4}{3}\right] \times M \to  \R:  (s, t, p) \mapsto K_{s, t}(p)
,\] 
with the following properties, as illustrated in Figure~\ref{fig:morse-homology-independence-two-dimensional-slide}:
\begin{itemize}
    \item $K_st = H_t$ for  $s \in \left[-\tfrac{1}{3}, \tfrac{1}{3}\right]$
        \item $K_st = G_t$ for  $s \in \left[\tfrac{2}{3}, \tfrac{4}{3}\right]$
        \item $K_{s, t} = F_s$ for $t \in \left[-\tfrac{1}{3}, \tfrac{1}{3}\right]$ 
        \item $K_{s,t} = f_2$ for $t \in \left[\tfrac{2}{3}, \tfrac{4}{3}\right]$
\end{itemize}
Note that these properties are not contradictory because we are working with stationary interpolations.

Now, to make a slide, we modify $K$ as follows:
 \[
     \tilde{K}_{s,t}(p) = K_{s,t}(p) + g(s) + g(t)
,\] 

\begin{marginfigure}
    \centering
    \incfig{morse-homology-independence-two-dimensional-slide-three-d}
    \caption{TODO morse homology independence two dimensional slide three d}
    \label{fig:morse-homology-independence-two-dimensional-slide-three-d}
\end{marginfigure}

with $g$ defined similarly as before, making $\tilde{K}$ a Morse function with critical points in the yellow regions in the figure.
The points correspond to critical points of $f_0$, $f_1$, $f_2$ and $f_2$ with indices raised by $2, 1, 1, 0$ respectively.
Also similarly as before, we can construct a pseudo-gradient vector field $X$ adapted to $\tilde{K}$, by adding $-\grad g(s)$, $-\grad g(t)$ at the appropriate regions and perturbing it in order to have the Smale property, again making sure that the perturbation is small enough such that $\partial_X = \partial_{\tilde X}$, where $\tilde{X}$ is the perturbed vector field.

While the resulting manifold $[-\frac{1}{3}, \frac{4}{3}]^2 \times M$ does not have a smooth boundary, the conditions (TODO add conditions) are still satisfied.
In summary, we have
\[
    C_{k+1}(\tilde{K}) = C_{k-1}(f_0) \oplus C_k(f_1) \oplus C_k(f_2) \oplus C_{k+1}(f_2)
,\] 
and the differential can be written as
\[
\partial_{\tilde{X}} = \begin{pmatrix}
    \partial_0 & 0 & 0 & 0\\
    \Phi^{F} &\partial_1 & 0 & 0 \\
    \Phi^{H} & 0 & \partial_2 & 0 \\
    S & \Phi^{G} & \operatorname{Id} & \partial_2
\end{pmatrix}
.\] 
Now, computing $\partial_{\tilde{X}}^2(p, 0, 0, 0)$ is like water trickling down four spillway bowls, as illustrated in Figure~\ref{fig:morse-homology-independence-partial-squared-zero-bis}. We get that
\[
\Phi^{G}  \circ  \Phi^{F} + \Phi^{H} + S \partial_0 + \partial_1 S = 0
,\] 
or as we are working over $\Z_2$,
\[
    \Phi^{G}  \circ \Phi^{F} - \Phi^{H} = S \partial_0 + \partial_1 S
,\] 
proving that $\Phi^{G}  \circ \Phi^{F}$ and $\Phi^{H}$ induce the same map on the level of homology.

\begin{figure*}
    \centering
    \fullwidthincfig{morse-homology-independence-partial-squared-zero-bis}
    \caption{TODO morse homology independence partial squared zero bis}
    \label{fig:morse-homology-independence-partial-squared-zero-bis}
\end{figure*}
\end{proof}

\section{The Künneth Formula}
The Künneth Formula is a way to relate the homology of a product to the homology of its factors and it states the following:
\begin{prop}[Künneth formula]
    Let $M, N$ be two manifolds. Then
    \[
        \HMf[k]{M \times N} \cong
        \bigoplus_{i+j  = k} \HMf[i]{M} \otimes \HMf[j]{N}
    ,\] 
where homology is taken with coefficients in $ \Z_2$.
\end{prop}
We can also express this in a different way using the Poincaré polynomial.
For this, define $\beta_k(M) = \dim_{\Z_2} \HMf[k]{M;\Z_2}$, the $k$th Betti number and let $P_M(t) = \sum_k \beta_k(M) ^{k}$.
Then the Künneth formula tells us that $P_{M \times N}(t) = P_M(t) P_N(t)$.
\begin{eg}
    We have $P_{S^{1}}(t) = 1 + t$, so $P_{S^{1}\times S^{1}\times S^{1}} = (1 + t)^3 = 1 + 3t + 3t^2 + 1t^3$, exactly the result we found in Example~\ref{eg:homology-of-the-three-torus}.
    More in general, we have that $\beta_k(T^{n})$ is the $k$th coefficient of $(1+t)^{n}$, i.e.\ $\binom{n}{k}$.
\end{eg}
\begin{proof}
    Let $f, g$ and $X, Y$ be two Morse functions, resp.\ pseudo-gradient fields on  $M$ and  $N$.
    Then $f + g$ is a Morse function and $(X, Y)$ is a pseudo-gradient field. If we assume that $X$ and  $Y$ satisfies the Smale condition, then so does $(X,Y)$.
    Critical points of $f+g$ are pairs of critical points of $f$ and $g$ and their indices are sums of the original indices. 
    Furthermore, trajectories of $(X, Y)$ correspond exactly to pairs of trajectories of $X$ and $Y$.
    Now, in order to understand the differential $\partial_{(X, Y)}$ on $M \times N$, we are interested in gradient flow lines that connect critical points $(a,b)$ and  $(c,d)$ whose index differ by exactly one.
    It's clear that the only way this can happen is when $a = c$ or $b = d$.\sidenote{
        If $a\neq c$ and  $b \neq d$, then  $\Ind c \ge  \Ind a + 1$ and $\Ind d \ge  \Ind b + 1$, so $\Ind (c, d) \ge  \Ind (a, b) + 2$.
    }

    When we think about this in terms of directed graphs of critical points, like we did in the example of $T^{3}$, we find that the graph of $M \times N$ is the Cartesian product of the graph of $M$ and the graph of  $N$.
    With these things in mind, it is easy to check that
    \begin{align*}
        \Phi: \bigoplus_{i+j = k} C_i(f) \otimes C_j(g) &\longrightarrow C_k(f+g) \\
        a \otimes b &\longmapsto (a,b)
    \end{align*}
    is an isomorphism of complexes with the following differentials:
    \[
        (C_\bul(f) \otimes C_\bul(g), \partial_X \otimes 1 + 1 \otimes \partial_Y) \xrightarrow{\Phi}   (C_\bul(f+g), \partial_{(X,Y)})
    ,\] 
    where $(C_\bul(f) \otimes C_\bul(g))_k := \bigoplus_{i+j = k} C_i(f) \otimes C_j(g)$.
    Now, taking the homology of both sides, and remembering that the homology of the tensor product complex is the tensor product of the homologies (Proposition~\ref{prop:hom-tensor-is-tensor-hom}), we get exactly what we want:
    \[
        \bigoplus_{i+j = k} \HMf[i]{M; \Z_2} \otimes \HMf[j]{N; \Z_2} \cong \HMf[k]{M \times N; \Z_2}
    .\] 
    Note that we take the homology with coefficients in $\Z_2$ in order to satisfy the conditions of Proposition~\ref{prop:hom-tensor-is-tensor-hom}.
\begin{marginfigure}
    \centering
    \incfig{kunneth-formula}
    \caption{TODO kunneth formula}
    \label{fig:kunneth-formula}
\end{marginfigure}
\end{proof}

\todo{Talk about orientation and $\Z_2$ vs $ \Z$.}


\todo{
    Refer to example \ref{eg:homology-of-the-three-torus}.
    Graph of critical points is `product' of graphs in some sense?
    Just normal Cartesian product of graphs?
}
\todo{Question: graph of critical points, seems interesting? Homology of a directed graph? Hmm not really.}
